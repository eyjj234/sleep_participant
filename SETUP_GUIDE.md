# 🚀 참가자 셀프 서비스 시스템 - 완벽 설정 가이드

## 🎯 시스템 개요

### 무엇이 달라졌나요?

**기존 방식 ❌**
- 관리자가 일일이 상태 업데이트
- 참가자 연락 → 관리자 확인 → 스프레드시트 업데이트
- 하루 1-2시간 소요

**새로운 방식 ✅**
- 참가자가 직접 상태 업데이트
- 자동으로 스프레드시트 반영
- 관리자는 알림만 받음
- **하루 5-10분 소요**

---

## 📦 제공 파일

1. **participant_interface_complete.html** - 참가자용 웹 인터페이스
2. **backend_script.gs** - Google Apps Script 백엔드
3. **data_collection_dashboard.html** - 관리자용 대시보드
4. **management_guide.md** - 운영 가이드

---

## ⚙️ 설정 단계 (30분이면 완료!)

### STEP 1: 구글 스프레드시트 준비 (5분)

#### 1-1. 새 스프레드시트 생성
```
파일 이름: 수면 데이터 수집 프로젝트 관리
```

#### 1-2. 시트 생성 (4개)

**시트1: 참가자마스터**
```
A열: 참가자ID (P001, P002, ...)
B열: 이름
C열: 연락처
D열: 이메일
E열: 주소
F열: 우편번호
G열: 순서 (1-150)
H열: 메모
```

**시트2: 진행현황** ⭐ 가장 중요!
```
A열: 참가자ID
B열: 이름
C열: 기기번호
D열: 현재상태 (드롭다운: 대기중/발송완료/수령완료/연동대기/수집중/수집완료/회수완료)
E열: 택배발송일
F열: 택배수령일
G열: 기기연동완료일
H열: 수집시작일
I열: 수집종료예정일
J열: 데이터확인일
K열: 택배반송일
L열: 다음액션
M열: 우선순위
N열: 메모
```

**시트3: 기기현황**
```
A열: 기기번호 (1-10)
B열: 현재상태 (사용중/사용가능)
C열: 현재사용자
D열: 사용시작일
E열: 예상반환일
```

**시트4: 액션로그**
```
A열: 날짜
B열: 시간
C열: 참가자ID
D열: 참가자명
E열: 액션
F열: 실행자 (참가자/관리자)
```

---

### STEP 2: Google Apps Script 설정 (10분)

#### 2-1. Apps Script 열기
1. 스프레드시트에서 `확장 프로그램` > `Apps Script` 클릭
2. 기본 코드 전부 삭제

#### 2-2. 백엔드 코드 복사
1. **backend_script.gs** 파일 열기
2. 전체 코드 복사
3. Apps Script에 붙여넣기

#### 2-3. 이메일 주소 변경
코드에서 아래 부분 찾아서 본인 이메일로 변경:
```javascript
var 수신자 = 'your-email@example.com'; // ← 여기!
```

세 군데 변경:
- `sendNotificationToManager` 함수 (1곳)
- `알림메일발송` 함수 (1곳)
- `참가자링크전송` 함수 (1곳)

#### 2-4. 저장 및 배포
1. 💾 저장 (Ctrl+S)
2. `배포` 버튼 클릭
3. `새 배포` 선택
4. ⚙️ 설정:
   - 유형: **웹 앱**
   - 실행 사용자: **나**
   - 액세스 권한: **모든 사용자**
5. `배포` 클릭
6. 권한 승인 (Google 계정으로 로그인)
7. **웹 앱 URL 복사** ← 이거 중요! 📋

```
AKfycbz_g3yeq9QbmAKJeBwNE2O9oX4IQVg1VlQiEFlqcRc_uQ8FomKeutvgEqDG6S1h5sYZ4w

https://script.google.com/macros/s/AKfycbz_g3yeq9QbmAKJeBwNE2O9oX4IQVg1VlQiEFlqcRc_uQ8FomKeutvgEqDG6S1h5sYZ4w/exec

```

---

### STEP 3: 참가자 웹페이지 설정 (5분)

#### 3-1. HTML 파일 수정
1. **participant_interface_complete.html** 파일을 텍스트 편집기로 열기
2. 23번째 줄 찾기:
```javascript
const SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE';
```

3. 복사한 웹 앱 URL로 교체:
```javascript
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx.../exec';
```

4. 저장

#### 3-2. 연락처 변경 (선택사항)
HTML 파일에서 전화번호 변경:
```html
<a href="tel:010-0000-0000" class="contact-button">
```
→ 본인 연락처로 변경

#### 3-3. 가이드 링크 변경 (선택사항)
가이드 문서가 있다면:
```javascript
const guides = {
    'app': 'https://your-guide-link.com/app-install',  // ← 앱 설치 가이드
    'check': 'https://your-guide-link.com/data-check'  // ← 데이터 확인 가이드
};
```

---

### STEP 4: 웹페이지 호스팅 (5분)

#### 옵션 A: Google Drive 호스팅 (추천) ✅

1. **Google Drive**에 접속
2. 새 폴더 생성: "수면데이터수집"
3. **participant_interface_complete.html** 업로드
4. 파일 우클릭 > `공유` > `링크 액세스 권한` > **링크가 있는 모든 사용자**
5. 링크 복사

**참가자에게 보낼 링크:**
```
https://drive.google.com/file/d/FILE_ID/view
```

#### 옵션 B: Google Sites (더 전문적) ⭐

1. **Google Sites** 접속 (sites.google.com)
2. 새 사이트 만들기
3. `삽입` > `HTML 삽입` 
4. HTML 코드 전체 붙여넣기
5. `게시` > 링크 복사

#### 옵션 C: GitHub Pages (개발자용)

1. GitHub에 새 레포지토리 생성
2. HTML 파일 업로드
3. Settings > Pages > Deploy
4. `https://username.github.io/repo-name` 링크 사용

---

### STEP 5: 자동화 트리거 설정 (2분)

#### 5-1. Apps Script에서 실행
1. Apps Script 편집기 열기
2. 함수 선택: `트리거설정`
3. ▶️ 실행 버튼 클릭
4. 권한 승인

#### 5-2. 확인
- `트리거` 메뉴에서 확인
- "일일체크" 트리거가 매일 오전 9시로 설정되어 있으면 성공!

---

### STEP 6: 테스트 (5분)

#### 6-1. 테스트 참가자 추가
**참가자마스터 시트에 추가:**
```
P001 | 홍길동 | 010-1234-5678 | test@email.com | 서울시... | 12345 | 1 | 테스트
```

#### 6-2. 진행현황 시트에 추가
```
P001 | 홍길동 | - | 대기중 | (나머지 빈칸)
```

#### 6-3. 참가자 페이지 테스트
1. 참가자 웹페이지 링크 열기
2. 로그인:
   - ID: P001
   - 이름: 홍길동
3. ✅ 진행 현황이 보이면 성공!

#### 6-4. 상태 업데이트 테스트
1. "발송완료"로 상태 변경 (관리자가 스프레드시트에서)
2. 참가자 페이지 새로고침
3. "수령 완료 알리기" 버튼 클릭
4. ✅ 스프레드시트에서 "수령완료" 상태로 변경되었는지 확인
5. ✅ 이메일로 알림 받았는지 확인

---

## 📧 참가자에게 링크 전송하기

### 방법 1: 개인 링크 (추천)

각 참가자에게 고유 링크 전송:
```
https://your-site.com?id=P001&name=홍길동
https://your-site.com?id=P002&name=김철수
...
```

장점: 
- 자동 로그인
- ID 입력 불필요
- 편리함

### 방법 2: 공통 링크

모든 참가자에게 동일한 링크:
```
https://your-site.com
```

참가자가 직접 ID와 이름 입력

### 방법 3: 자동 이메일 발송

Apps Script에서 자동 발송:
```javascript
// Apps Script에서 실행
참가자링크전송();
```

- 참가자마스터의 모든 이메일로 자동 발송
- 개인 링크 포함

---

## 📱 참가자 사용 흐름

```
1. 링크 수신 (이메일/문자)
   ↓
2. 웹페이지 접속
   ↓
3. ID/이름 입력 (또는 자동 로그인)
   ↓
4. 현재 진행 상황 확인
   ↓
5. 해당 단계의 체크리스트 완료
   ↓
6. "완료 알리기" 버튼 클릭
   ↓
7. ✅ 자동으로 스프레드시트 업데이트
   ↓
8. 📧 관리자에게 알림 전송
```

---

## 🎯 관리자 워크플로우

### 매일 아침 (5분)
1. 📧 이메일 확인
   - 자동 알림: 긴급 액션
   - 참가자 업데이트 알림
2. 대시보드 확인 (선택)
3. 필요한 액션만 처리

### 발송 시
1. 스프레드시트에서 상태 → "발송완료"
2. 발송일 기록
3. (자동) 참가자가 수령 시 알림 받음

### 회수 시
1. (자동) 참가자가 "수집완료" 클릭 → 알림 받음
2. 우체국 픽업 예약
3. 회수 후 상태 → "회수완료"

---

## 🔥 핵심 장점

### 1. 시간 절약
- **기존**: 하루 1-2시간
- **자동화 후**: 하루 5-10분
- **절감**: 90% ⬇️

### 2. 실수 방지
- 참가자가 직접 체크리스트 완료
- 놓치는 단계 없음
- 실시간 알림

### 3. 참가자 만족도 ⬆️
- 진행 상황을 직접 확인
- 투명한 프로세스
- 자율성 증가

### 4. 데이터 정확도
- 실시간 업데이트
- 사람 실수 최소화
- 자동 로그 기록

---

## 🛠️ 문제 해결

### Q1: 참가자가 로그인이 안 돼요
**원인:** ID 또는 이름 불일치
**해결:**
1. 스프레드시트에서 참가자 정보 확인
2. 대소문자 확인 (P001 vs p001)
3. 띄어쓰기 확인

### Q2: 상태 업데이트가 안 돼요
**원인:** Apps Script URL 미설정
**해결:**
1. HTML 파일의 `SCRIPT_URL` 확인
2. 웹 앱 배포 확인
3. Apps Script 권한 확인

### Q3: 이메일 알림이 안 와요
**원인:** 이메일 주소 미설정
**해결:**
1. backend_script.gs에서 이메일 주소 확인
2. Gmail 설정에서 Apps Script 허용 확인

### Q4: 참가자 페이지가 안 열려요
**원인:** 호스팅 문제
**해결:**
1. Google Drive 공유 설정 확인
2. 링크 권한 확인 ("링크가 있는 모든 사용자")

---

## 🎉 다음 단계

### 설정 완료 후:
1. ✅ 테스트 참가자로 전체 플로우 테스트
2. ✅ 첫 10명에게 링크 발송
3. ✅ 피드백 수집 및 개선
4. ✅ 전체 참가자에게 확대

### 추가 기능 (선택):
- 📱 카카오톡 알림톡 연동
- 📦 우체국 택배 API 연동
- 📊 실시간 대시보드 업그레이드
- 🤖 챗봇 지원

---

## 💡 프로 팁

1. **개인 링크 사용**: 참가자 편의성 극대화
2. **매주 통계 리뷰**: 진행률 모니터링
3. **가이드 문서 완비**: 문의 사항 최소화
4. **자동 백업 설정**: 스프레드시트 버전 관리
5. **참가자 피드백**: 지속적 개선

---

## ✅ 체크리스트

설정 완료 확인:
- [ ] 구글 스프레드시트 4개 시트 생성
- [ ] Apps Script 코드 복사 및 이메일 변경
- [ ] 웹 앱 배포 및 URL 복사
- [ ] HTML 파일에 URL 설정
- [ ] 웹페이지 호스팅 완료
- [ ] 트리거 설정 완료
- [ ] 테스트 참가자로 테스트 완료
- [ ] 첫 참가자에게 링크 발송

**모든 체크 완료 시 설정 끝! 🎊**

---

## 📞 추가 지원

문제가 계속되면:
1. Apps Script 실행 로그 확인
2. 스프레드시트 공유 설정 확인
3. 브라우저 콘솔 에러 확인

**프로젝트 성공을 응원합니다! 🚀**
