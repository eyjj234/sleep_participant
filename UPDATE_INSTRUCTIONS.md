# 🔄 업데이트 적용 방법

## 1️⃣ Google Apps Script 업데이트 (필수!)

### ⚠️ 중요: backend_script.gs를 반드시 업데이트해야 합니다!

1. **Google Sheets 열기**

   - 진행현황 스프레드시트 접속

2. **Apps Script 편집기 열기**

   - 상단 메뉴: `확장 프로그램` > `Apps Script`

3. **코드 전체 교체**

   - 왼쪽 파일 목록에서 `코드.gs` (또는 기존 스크립트 파일) 클릭
   - 기존 코드를 **전체 선택** (Cmd+A 또는 Ctrl+A)
   - **삭제**
   - `/Users/jj/Desktop/python/25-10-28_sleep_platform/backend_script.gs` 파일의 내용을 **전체 복사**
   - Apps Script 편집기에 **붙여넣기**

4. **저장 및 배포**

   - 💾 저장 버튼 클릭 (Cmd+S 또는 Ctrl+S)
   - `배포` > `배포 관리` 클릭
   - 기존 배포 옆 ⚙️ 아이콘 클릭
   - `새 버전` 선택
   - `배포` 버튼 클릭

5. **완료!**
   - 1-2분 후 새로운 기능이 적용됩니다.

---

## 2️⃣ 웹페이지는 자동 업데이트됩니다

GitHub Pages가 자동으로 새 버전을 배포합니다 (1-2분 소요).

- **참가자 페이지**: https://eyjj234.github.io/sleep_participant/participant_interface_complete.html
- **관리자 대시보드**: https://eyjj234.github.io/sleep_participant/admin_dashboard.html

---

## 3️⃣ 주요 변경사항

### ✅ 복원 및 추가된 기능

1. **5단계: 데이터 확인** - 참가자가 수면 데이터 정상 여부 확인
2. **6단계: 설문 작성** ⭐ NEW - Google Form 설문 작성 (5-10분 소요)
3. **7단계: 데이터 제출** - 데이터 제공 동의 후 제출
4. **8단계: 매니저 데이터 확인** - 매니저 검토 대기
5. **9단계: 기기 반납 준비** (기존 5단계에서 이동)
6. **10단계: 완료!** (기존 6단계에서 이동)

### 🎨 디자인 개선

- ✅ 노란색 배경 상태 배지의 글자색을 **검정색**으로 변경 (가독성 향상)
- ✅ 모든 페이지 검/흰/노랑 미니멀 디자인 유지
- ✅ **참가자 이름 & ID 상단 고정** (sticky header) - 스크롤해도 항상 보임
- ✅ **전체 가이드 링크** 추가 (노란색 배너)

### 📝 텍스트 개선

- ✅ 3단계: "앱에서 수면 데이터가 보입니다" → "동기화 완료되어 '방금 동기화 완료'를 확인할 수 있습니다"
  - 슬랙 문의 안내 추가
- ✅ 4단계: 전화번호 안내 → "슬랙으로 알려주세요"
- ✅ 도움 섹션: "슬랙 채널 우선 문의, 급한 경우 전화번호" 형식으로 변경

### 🔧 기능 개선

- ✅ 측정 상태가 **status 기반**으로 정확하게 표시됨
  - 예전: 날짜만 체크해서 부정확
  - 지금: "수집완료" 상태일 때만 ✅ 완료 표시
- ✅ 데이터 확인 단계에서 Yes/No 버튼으로 진행
- ✅ backend에 새로운 상태 처리 로직 추가

---

## 4️⃣ 기기현황 대시보드 반영 방법

### 📊 기기 상태는 스프레드시트에서 관리됩니다

1. **Google Sheets에서 "기기현황" 시트 열기**

   - 시트가 없으면 자동으로 생성됩니다 (첫 로그인 시)

2. **기기 상태 업데이트**

| 기기번호 | 현재상태     | 현재사용자 | 사용시작일 | 예상반환일 |
| -------- | ------------ | ---------- | ---------- | ---------- |
| 1        | **사용가능** | -          |            |            |
| 2        | **사용중**   | 0001       | 2025-10-28 | 2025-11-05 |
| 3        | **수리중**   | 수리센터   |            |            |

**상태 옵션:**

- `사용가능` - 초록 배경, 검정 테두리
- `사용중` - 노란 배경, 검정 테두리
- `수리중` - 회색 배경, 검정 테두리

3. **자동 반영**
   - 스프레드시트 업데이트 후 관리자 대시보드를 새로고침하면 즉시 반영됩니다.

---

## 5️⃣ 스프레드시트 구조

### 진행현황 시트 (열 구조)

| 열  | 이름           | 설명                                                                                                                            |
| --- | -------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| A   | 참가자ID       | 예: 0001, 0002                                                                                                                  |
| B   | 이름           | 참가자 이름                                                                                                                     |
| C   | 기기번호       | 1-10                                                                                                                            |
| D   | 현재상태       | 대기중, 발송완료, 수령완료, 수집중, 수집완료, 데이터확인완료, 설문완료, 데이터제출완료, 매니저확인완료, 회수대기, 회수완료 ⭐ |
| E   | 등록일         |                                                                                                                                 |
| F   | 수령일         |                                                                                                                                 |
| G   | 연동완료일     |                                                                                                                                 |
| H   | 수집시작일     |                                                                                                                                 |
| I   | 수집종료예정일 |                                                                                                                                 |
| J   | 데이터확인일   | 5단계 완료 시                                                                                                                   |
| K   | 설문완료일     | 6단계 완료 시 ⭐ NEW                                                                                                            |
| L   | 데이터제출일   | 7단계 완료 시                                                                                                                   |
| M   | 매니저확인일   | 8단계 완료 시 (매니저가 직접 업데이트)                                                                                          |
| N   | ...            |                                                                                                                                 |

### 기기현황 시트

| 열  | 이름       | 설명                     |
| --- | ---------- | ------------------------ |
| A   | 기기번호   | 1-10                     |
| B   | 현재상태   | 사용가능, 사용중, 수리중 |
| C   | 현재사용자 | 참가자 ID 또는 "-"       |
| D   | 사용시작일 |                          |
| E   | 예상반환일 |                          |

---

## ✅ 체크리스트

Apps Script 업데이트 전에 확인:

- [ ] `backend_script.gs` 파일을 Apps Script 편집기에 복사
- [ ] 저장 완료
- [ ] 새 버전으로 배포 완료
- [ ] 1-2분 대기
- [ ] 참가자 페이지에서 로그인 테스트
- [ ] 새로운 5-7단계가 보이는지 확인

---

## 🚨 문제 해결

### "알 수 없는 요청입니다" 오류가 뜨는 경우

→ Apps Script를 업데이트하지 않아서입니다. 위의 1번 단계를 다시 진행하세요.

### 기기현황이 대시보드에 반영 안되는 경우

→ "기기현황" 시트 이름을 정확히 입력했는지 확인하세요 (한글, 띄어쓰기 없음).

### 새로운 단계가 안 보이는 경우

→ 브라우저 캐시를 삭제하거나 시크릿 모드로 접속해보세요.

---

## 📞 도움이 필요하신가요?

**슬랙 채널에서 문의** (우선)  
(급한 경우 📞 010-4343-4195)
