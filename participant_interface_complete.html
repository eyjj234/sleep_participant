<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ìˆ˜ë©´ ë°ì´í„° ìˆ˜ì§‘ - ì°¸ê°€ì í˜ì´ì§€</title>
    <style>
      @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Pretendard", -apple-system, BlinkMacSystemFont, "Segoe UI",
          "Apple SD Gothic Neo", sans-serif;
        background: #ffffff;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
      }

      .card {
        background: white;
        border-radius: 12px;
        padding: 30px;
        border: 2px solid #000000;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 1);
        margin-bottom: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 28px;
        color: #333;
        margin-bottom: 10px;
      }

      .header .subtitle {
        color: #666;
        font-size: 14px;
      }

      .input-group {
        margin-bottom: 20px;
      }

      .input-group label {
        display: block;
        font-size: 14px;
        color: #666;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .input-group input {
        width: 100%;
        padding: 15px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      .input-group input:focus {
        outline: none;
        border-color: #000000;
        box-shadow: 0 0 0 3px rgba(255, 235, 59, 0.3);
      }

      .btn {
        width: 100%;
        padding: 15px;
        background: #000000;
        color: white;
        border: 2px solid #000000;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn:hover:not(:disabled) {
        background: #333333;
        transform: translateY(-2px);
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.3);
      }

      .btn:disabled {
        background: #cccccc;
        border-color: #cccccc;
        cursor: not-allowed;
        transform: none;
      }

      .progress-section {
        display: none;
      }

      .user-info {
        background: #000000;
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 25px;
        color: white;
        position: sticky;
        top: 20px;
        z-index: 100;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 1);
      }

      .user-info h2 {
        font-size: 22px;
        margin-bottom: 15px;
      }

      .guide-banner {
        background: #ffeb3b;
        border: 2px solid #000000;
        padding: 16px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
      }

      .guide-banner a {
        color: #000000;
        font-weight: bold;
        font-size: 15px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .guide-banner a:hover {
        text-decoration: underline;
      }

      .user-info .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .user-info .info-item {
        background: rgba(255, 255, 255, 0.2);
        padding: 12px;
        border-radius: 10px;
      }

      .user-info .label {
        font-size: 12px;
        opacity: 0.9;
        margin-bottom: 5px;
      }

      .user-info .value {
        font-size: 16px;
        font-weight: bold;
      }

      .status-badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: bold;
        background: #ffeb3b;
        color: #000000;
        border: 2px solid #000000;
      }

      .alert {
        padding: 18px;
        border-radius: 12px;
        margin-bottom: 25px;
        font-size: 15px;
        line-height: 1.6;
      }

      .alert-info {
        background: #f5f5f5;
        color: #000000;
        border: 2px solid #000000;
      }

      .alert-success {
        background: #ffeb3b;
        color: #000000;
        border: 2px solid #000000;
      }

      .alert-warning {
        background: #ffffff;
        color: #000000;
        border: 2px solid #000000;
        border-left: 4px solid #ffeb3b;
      }

      .timeline {
        position: relative;
        padding: 20px 0;
      }

      .timeline::before {
        content: "";
        position: absolute;
        left: 20px;
        top: 0;
        bottom: 0;
        width: 3px;
        background: #000000;
      }

      .timeline-step {
        position: relative;
        padding-left: 60px;
        margin-bottom: 35px;
        opacity: 0.5;
        transition: opacity 0.3s;
      }

      .timeline-step.active,
      .timeline-step.completed {
        opacity: 1;
      }

      .timeline-step .step-circle {
        position: absolute;
        left: 8px;
        top: 0;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: bold;
        color: #999;
        border: 3px solid white;
        z-index: 1;
      }

      .timeline-step.active .step-circle {
        background: #ffeb3b;
        color: #000000;
        box-shadow: 0 0 0 6px rgba(255, 235, 59, 0.3);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 0 0 6px rgba(255, 235, 59, 0.3);
        }
        50% {
          box-shadow: 0 0 0 10px rgba(255, 235, 59, 0.15);
        }
      }

      .timeline-step.completed .step-circle {
        background: #000000;
        color: white;
      }

      .timeline-step.completed .step-circle::after {
        content: "âœ“";
      }

      .step-content {
        background: #f8f9fa;
        padding: 22px;
        border-radius: 12px;
        border-left: 4px solid #e9ecef;
      }

      .timeline-step.active .step-content {
        background: white;
        border-left-color: #ffeb3b;
        border: 2px solid #000000;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 1);
      }

      .timeline-step.completed .step-content {
        border-left-color: #000000;
      }

      .step-title {
        font-size: 17px;
        font-weight: bold;
        color: #333;
        margin-bottom: 12px;
      }

      .step-description {
        font-size: 14px;
        color: #666;
        margin-bottom: 16px;
        line-height: 1.7;
      }

      .checklist {
        margin: 16px 0;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
      }

      .checklist-item {
        display: flex;
        align-items: center;
        padding: 10px;
        font-size: 14px;
        color: #333;
        border-radius: 6px;
        margin-bottom: 8px;
        transition: background 0.2s;
      }

      .checklist-item:hover {
        background: white;
      }

      .checklist-item input[type="checkbox"] {
        margin-right: 12px;
        width: 20px;
        height: 20px;
        cursor: pointer;
      }

      .action-button {
        margin-top: 18px;
      }

      .guide-link {
        display: inline-flex;
        align-items: center;
        color: #000000;
        text-decoration: underline;
        font-size: 14px;
        margin-top: 12px;
        font-weight: 600;
        padding: 8px 0;
      }

      .guide-link:hover {
        background: #ffeb3b;
        padding: 8px 12px;
        border-radius: 4px;
        text-decoration: none;
      }

      .help-section {
        background: #f5f5f5;
        padding: 25px;
        border-radius: 12px;
        border: 2px solid #000000;
        margin-top: 25px;
        text-align: center;
      }

      .help-section h3 {
        font-size: 18px;
        color: #333;
        margin-bottom: 12px;
      }

      .help-section p {
        font-size: 14px;
        color: #666;
        line-height: 1.6;
        margin-bottom: 15px;
      }

      .contact-button {
        display: inline-block;
        padding: 12px 30px;
        background: #ffeb3b;
        color: #000000;
        text-decoration: none;
        border-radius: 8px;
        border: 2px solid #000000;
        font-size: 15px;
        font-weight: 600;
        transition: all 0.2s;
      }

      .contact-button:hover {
        background: #000000;
        color: #ffeb3b;
        transform: translateY(-2px);
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.3);
      }

      .loading {
        text-align: center;
        padding: 50px;
        color: #666;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #000000;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .logout-button {
        background: #6c757d;
        padding: 12px;
        font-size: 14px;
        margin-top: 15px;
      }

      .error-message {
        text-align: center;
        color: #dc3545;
        padding: 20px;
        font-size: 15px;
        background: #ffe6e6;
        border-radius: 10px;
        margin: 15px 0;
      }

      .collection-progress {
        background: #e3f2fd;
        padding: 20px;
        border-radius: 12px;
        margin: 15px 0;
      }

      .collection-progress .days-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-top: 12px;
      }

      .collection-progress .day-box {
        aspect-ratio: 1;
        background: white;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        color: #999;
        border: 2px solid #e9ecef;
      }

      .collection-progress .day-box.completed {
        background: #4caf50;
        color: white;
        border-color: #4caf50;
      }

      .collection-progress .day-box.current {
        background: #667eea;
        color: white;
        border-color: #667eea;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- ë¡œê·¸ì¸ ì¹´ë“œ -->
      <div class="card" id="login-card">
        <div class="header">
          <h1>ğŸŒ™ ìˆ˜ë©´ ë°ì´í„° ìˆ˜ì§‘</h1>
          <p class="subtitle">ì°¸ê°€ì ì§„í–‰ í˜„í™© í˜ì´ì§€</p>
        </div>

        <div class="input-group">
          <label for="participant-id">ì°¸ê°€ì ID</label>
          <input
            type="text"
            id="participant-id"
            placeholder="ì˜ˆ: 0001"
            maxlength="4"
            pattern="[0-9]{4}"
            inputmode="numeric"
          />
        </div>
        <div class="input-group">
          <label for="participant-name">ì´ë¦„</label>
          <input type="text" id="participant-name" placeholder="í™ê¸¸ë™" />
        </div>
        <button class="btn" onclick="login()" id="login-btn">ë¡œê·¸ì¸</button>
        <p
          style="
            text-align: center;
            margin-top: 15px;
            font-size: 13px;
            color: #666;
          "
        >
          ğŸ’¬ ì°¸ê°€ì IDëŠ” ì°¸ì—¬ìš”ì²­ ë¬¸ìì™€ ìŠ¬ë™ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <div id="login-error" class="error-message" style="display: none"></div>
      </div>

      <!-- ì§„í–‰ í˜„í™© ì¹´ë“œ -->
      <div class="card progress-section" id="progress-card">
        <div class="header">
          <h1>ë‚˜ì˜ ì§„í–‰ í˜„í™©</h1>
        </div>

        <div class="user-info" id="user-info">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
        </div>

        <div class="guide-banner">
          <a
            href="https://docs.google.com/presentation/d/1UvG6Vl1lWJlcOITc3KmaJboFYnmo1FDiJ-nk9qrsrH8/edit?slide=id.p#slide=id.p"
            target="_blank"
          >
            ğŸ“– ì „ì²´ ìˆ˜ì§‘ ê°€ì´ë“œë¥¼ ì½ê³  ì§„í–‰í•´ì£¼ì„¸ìš” â†’
          </a>
        </div>

        <div id="current-alert" style="display: none">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
        </div>

        <div class="timeline" id="timeline">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
        </div>

        <div class="help-section">
          <h3>â“ ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?</h3>
          <p>
            ê¸°ê¸° ì—°ë™ì´ ì•ˆ ë˜ê±°ë‚˜ ë¬¸ì œê°€ ë°œìƒí•˜ë©´<br />
            ì–¸ì œë“  ì—°ë½ì£¼ì„¸ìš”. ë¹ ë¥´ê²Œ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤!
          </p>
          <p
            style="
              font-size: 18px;
              font-weight: bold;
              color: #333;
              margin-top: 12px;
            "
          >
            ğŸ’¬ ìŠ¬ë™ ì±„ë„ì—ì„œ ë¬¸ì˜ (ìš°ì„ )<br />
            <span style="font-size: 15px; color: #666; font-weight: normal"
              >(ê¸‰í•œ ê²½ìš° ğŸ“ 010-4343-4195)</span
            >
          </p>
        </div>

        <button class="btn logout-button" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <script>
      // ===== ì„¤ì • =====
      const SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbzmoL1ZiRcMjXPQXtJj7C2lEpwug1NYz6y4TCSUGJLDp7Pd7uRw1OgLu7yW9huztAPJKQ/exec";
      let currentUser = null;

      // ===== ë¡œê·¸ì¸ =====
      async function login() {
        const id = document.getElementById("participant-id").value.trim();
        const name = document.getElementById("participant-name").value.trim();

        if (!id || !name) {
          showError("login-error", "ì°¸ê°€ì IDì™€ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        // ì°¸ê°€ì ID ìœ íš¨ì„± ê²€ì‚¬ (ìˆ«ì 4ìë¦¬)
        if (!/^\d{4}$/.test(id)) {
          showError(
            "login-error",
            "ì°¸ê°€ì IDëŠ” ìˆ«ì 4ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: 0001)"
          );
          return;
        }

        const btn = document.getElementById("login-btn");
        btn.disabled = true;
        btn.textContent = "ë¡œê·¸ì¸ ì¤‘...";

        try {
          const response = await fetch(SCRIPT_URL, {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: JSON.stringify({
              action: "getParticipant",
              id: id,
              name: name,
            }),
          });

          const result = await response.json();

          if (result.success) {
            currentUser = result.data;
            showProgress(result.data);
            document.getElementById("login-error").style.display = "none";
          } else {
            showError("login-error", result.message);
          }
        } catch (error) {
          showError(
            "login-error",
            "ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
          );
          console.error(error);
        } finally {
          btn.disabled = false;
          btn.textContent = "ë¡œê·¸ì¸";
        }
      }

      // ===== ì§„í–‰ í˜„í™© í‘œì‹œ =====
      function showProgress(data) {
        document.getElementById("login-card").style.display = "none";
        document.getElementById("progress-card").style.display = "block";

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        renderUserInfo(data);

        // í˜„ì¬ ìƒíƒœ ì•Œë¦¼
        renderCurrentAlert(data);

        // íƒ€ì„ë¼ì¸ ë Œë”ë§
        renderTimeline(data);
      }

      // ===== ì‚¬ìš©ì ì •ë³´ ë Œë”ë§ =====
      function renderUserInfo(data) {
        const statusColor = getStatusColor(data.status);

        document.getElementById("user-info").innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h2 style="margin: 0;">${data.name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‘‹</h2>
                    <div style="text-align: right;">
                        <div style="font-size: 14px; opacity: 0.8;">ì°¸ê°€ì ID</div>
                        <div style="font-size: 20px; font-weight: bold;">${data.id}</div>
                    </div>
                </div>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="label">ë°°ì • ê¸°ê¸°</div>
                        <div class="value">${data.device}</div>
                    </div>
                    <div class="info-item">
                        <div class="label">í˜„ì¬ ìƒíƒœ</div>
                        <div class="value"><span class="status-badge" style="color: ${statusColor}">${data.status}</span></div>
                    </div>
                </div>
            `;
      }

      // ===== í˜„ì¬ ìƒíƒœ ì•Œë¦¼ ë Œë”ë§ =====
      function renderCurrentAlert(data) {
        const alertDiv = document.getElementById("current-alert");
        const alerts = {
          ëŒ€ê¸°ì¤‘: {
            type: "info",
            message: "ê³§ ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ê°€ ë°œì†¡ë  ì˜ˆì •ì…ë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!",
          },
          ë°œì†¡ì™„ë£Œ: {
            type: "warning",
            message:
              "ğŸ“¦ ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. íƒë°°ë¥¼ ë°›ìœ¼ì‹œë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.",
          },
          ìˆ˜ë ¹í™•ì¸í•„ìš”: {
            type: "warning",
            message: "âš ï¸ íƒë°°ê°€ ë„ì°©í–ˆì„ ì˜ˆì •ì…ë‹ˆë‹¤. ìˆ˜ë ¹í•˜ì…¨ë‚˜ìš”?",
          },
          ìˆ˜ë ¹ì™„ë£Œ: {
            type: "info",
            message: "ğŸ“± ì´ì œ ì•±ì„ ì„¤ì¹˜í•˜ê³  ê¸°ê¸°ë¥¼ ì—°ë™í•´ì£¼ì„¸ìš”.",
          },
          ì—°ë™ëŒ€ê¸°: {
            type: "warning",
            message:
              "âš ï¸ ì•„ì§ ê¸°ê¸° ì—°ë™ì´ í™•ì¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê°€ì´ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.",
          },
          ì—°ë™ì™„ë£Œ: {
            type: "info",
            message: "âœ… ê¸°ê¸° ì—°ë™ ì™„ë£Œ! ì´ì œ ì¸¡ì • ì˜ˆì •ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.",
          },
          ìˆ˜ì§‘ì¤‘: {
            type: "warning",
            message: data.collectStartDate
              ? `ğŸ˜´ ê¸°ìƒ ì˜ˆì •ì¼: ${data.collectStartDate} (ì „ë‚  ë°¤~í•´ë‹¹ì¼ ì•„ì¹¨ ìˆ˜ë©´ ì¸¡ì •)<br>ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ë¥¼ ì°©ìš©í•˜ê³  ì£¼ë¬´ì„¸ìš”.`
              : `âš ï¸ ì—°ë™ ì™„ë£Œ! 1-2ì¼ ë‚´ì— ì¸¡ì • ë¶€íƒë“œë¦¬ë©°, ì¶”ê°€ ì‹œê°„ì´ í•„ìš”í•œ ê²½ìš° ìŠ¬ë™ìœ¼ë¡œ ì•Œë ¤ì£¼ì„¸ìš”.`,
          },
          ìˆ˜ì§‘ì™„ë£Œ: {
            type: "success",
            message:
              "ğŸ‰ ì¸¡ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì•±ì—ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.",
          },
        };

        const alert = alerts[data.status] || {
          type: "info",
          message: "ìƒíƒœë¥¼ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤.",
        };

        alertDiv.className = "alert alert-" + alert.type;
        alertDiv.innerHTML = alert.message;
        alertDiv.style.display = "block";
      }

      // ===== íƒ€ì„ë¼ì¸ ë Œë”ë§ =====
      function renderTimeline(data) {
        const timeline = document.getElementById("timeline");
        const steps = getTimelineSteps(data);

        timeline.innerHTML = steps
          .map(
            (step, index) => `
                <div class="timeline-step ${step.state}" data-step="${
              index + 1
            }">
                    <div class="step-circle">${
                      step.state === "completed" || step.state === "active"
                        ? ""
                        : index + 1
                    }</div>
                    <div class="step-content">
                        <div class="step-title">${step.title}</div>
                        <div class="step-description">${step.description}</div>
                        ${step.content || ""}
                    </div>
                </div>
            `
          )
          .join("");
      }

      // ===== íƒ€ì„ë¼ì¸ ë‹¨ê³„ ìƒì„± =====
      function getTimelineSteps(data) {
        const currentStep = getStepNumber(data.status);

        return [
          {
            state: currentStep >= 1 ? "completed" : "",
            title: "1ë‹¨ê³„: ì°¸ê°€ í™•ì •",
            description:
              "í”„ë¡œì íŠ¸ ì°¸ê°€ê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ê³§ ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ê°€ ë°œì†¡ë  ì˜ˆì •ì…ë‹ˆë‹¤.",
          },
          {
            state:
              currentStep > 2 ? "completed" : currentStep === 2 ? "active" : "",
            title: "2ë‹¨ê³„: íƒë°° ìˆ˜ë ¹ ëŒ€ê¸°",
            description: data.shipDate
              ? `ë°œì†¡ì¼: ${data.shipDate}`
              : "ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ê°€ ê³§ ë°œì†¡ë©ë‹ˆë‹¤.",
            content:
              currentStep === 2
                ? `
                        <div class="checklist">
                            <div class="checklist-item">
                                <input type="checkbox" id="check-received">
                                <label for="check-received">íƒë°°ë¥¼ ìˆ˜ë ¹í–ˆìŠµë‹ˆë‹¤</label>
                            </div>
                            <div class="checklist-item">
                                <input type="checkbox" id="check-contents">
                                <label for="check-contents">ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ì™€ ì¶©ì „ê¸°ê°€ ëª¨ë‘ ë“¤ì–´ìˆìŠµë‹ˆë‹¤</label>
                            </div>
                        </div>
                        <div class="action-button">
                            <button class="btn" onclick="updateStatus('ìˆ˜ë ¹ì™„ë£Œ')">âœ“ ìˆ˜ë ¹ ì™„ë£Œ ì•Œë¦¬ê¸°</button>
                        </div>
                    `
                : "",
          },
          {
            state:
              currentStep > 3 ? "completed" : currentStep === 3 ? "active" : "",
            title: "3ë‹¨ê³„: ì•± ì„¤ì¹˜ ë° ê¸°ê¸° ì—°ë™",
            description: "ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ ì•±ì„ ì„¤ì¹˜í•˜ê³  ê¸°ê¸°ë¥¼ ì—°ë™í•´ì£¼ì„¸ìš”.",
            content:
              currentStep === 3
                ? `
                        <a href="#" class="guide-link" onclick="openGuide('app'); return false;">ğŸ“± ì•± ì„¤ì¹˜ ê°€ì´ë“œ ë³´ê¸° â†’</a>
                        <div class="checklist">
                            <div class="checklist-item">
                                <input type="checkbox" id="check-app-install">
                                <label for="check-app-install">ì•±ì„ ì„¤ì¹˜í–ˆìŠµë‹ˆë‹¤</label>
                            </div>
                            <div class="checklist-item">
                                <input type="checkbox" id="check-device-sync">
                                <label for="check-device-sync">ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ì™€ ì—°ë™í–ˆìŠµë‹ˆë‹¤</label>
                            </div>
                            <div class="checklist-item">
                                <input type="checkbox" id="check-data-visible">
                                <label for="check-data-visible">ë™ê¸°í™” ì™„ë£Œë˜ì–´ "ë°©ê¸ˆ ë™ê¸°í™” ì™„ë£Œ"ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</label>
                            </div>
                        </div>
                        <div class="alert alert-info" style="margin-top: 12px; font-size: 13px;">
                            ğŸ’¡ ë™ê¸°í™”ê°€ ë˜ì—ˆëŠ”ì§€ ë¶ˆí™•ì‹¤í•œ ê²½ìš° ìŠ¬ë™ìœ¼ë¡œ ë§¤ë‹ˆì €ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.
                        </div>
                        <div style="height: 0; overflow: hidden;">
                            <div class="checklist-item" style="display: none;">
                                <input type="checkbox" id="dummy-check" checked>
                                <label for="dummy-check">hidden</label>
                            </div>
                        </div>
                        <div class="action-button">
                            <button class="btn" onclick="updateStatus('ì—°ë™ì™„ë£Œ')">âœ“ ì—°ë™ ì™„ë£Œ ì•Œë¦¬ê¸°</button>
                        </div>
                    `
                : "",
          },
          {
            state:
              currentStep > 4 ? "completed" : currentStep === 4 ? "active" : "",
            title: "4ë‹¨ê³„: ë°ì´í„° ì¸¡ì • (1ì¼)",
            description: `ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ë¥¼ ì°©ìš©í•˜ê³  í•˜ë£¨ ë°¤ ìˆ˜ë©´ì„ ì¸¡ì •í•´ì£¼ì„¸ìš”.${
              data.collectStartDate
                ? "<br><strong>ê¸°ìƒ ì˜ˆì •ì¼: " +
                  data.collectStartDate +
                  "</strong> (ì „ë‚  ë°¤ë¶€í„° ì¸¡ì •)"
                : "<br><span style='color: #ff6b6b;'>âš ï¸ ì—°ë™ í›„ 1-2ì¼ ë‚´ ì¸¡ì • ë¶€íƒë“œë¦½ë‹ˆë‹¤!</span>"
            }`,
            content:
              currentStep === 4
                ? `
                        <div style="background: #ffeb3b; padding: 20px; border-radius: 12px; border: 2px solid #000000; margin-bottom: 20px;">
                            <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #000;">
                                ğŸ“… ìˆ˜ë©´ ì¸¡ì • ë‚ ì§œ ì„ íƒ
                            </label>
                            <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; font-size: 13px; color: #333; line-height: 1.6;">
                                ğŸ’¡ <strong>ì¤‘ìš”:</strong> ì•„ì¹¨ì— ì¼ì–´ë‚œ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.<br>
                                <span style="color: #666;">
                                ì˜ˆ) 26ì¼ ë°¤ 11ì‹œì— ì ë“¤ì–´ 27ì¼ ì•„ì¹¨ 7ì‹œì— ì¼ì–´ë‚¬ë‹¤ë©´<br>
                                â†’ <strong>27ì¼</strong>ì„ ì„ íƒí•˜ì„¸ìš” (26ì¼ ë°¤~27ì¼ ì•„ì¹¨ ìˆ˜ë©´)
                                </span>
                            </div>
                            <input type="date" id="measure-date" 
                                   value="${data.collectStartDate || ""}"
                                   style="width: 100%; padding: 12px; border: 2px solid #000000; border-radius: 8px; font-size: 16px;">
                            <button class="btn" onclick="updateMeasureDate()" 
                                    style="margin-top: 12px; background: #000000;">
                                ğŸ“… ì¸¡ì •ì¼ ${
                                  data.collectStartDate ? "ë³€ê²½" : "ì„¤ì •"
                                }í•˜ê¸°
                            </button>
                        </div>

                        ${
                          data.collectStartDate
                            ? `
                            <div class="collection-progress">
                                <div style="text-align: center; font-weight: bold; color: #1976d2; margin-bottom: 8px;">
                                    ì¸¡ì • ìƒíƒœ: ${
                                      data.status === "ìˆ˜ì§‘ì™„ë£Œ"
                                        ? "âœ… ì™„ë£Œ"
                                        : data.collectDays >= 1
                                        ? "âœ… ì¸¡ì •ì¼ ë„ë‹¬"
                                        : "â³ ëŒ€ê¸°ì¤‘"
                                    }
                                </div>
                                <div style="text-align: center; padding: 20px; background: white; border-radius: 10px;">
                                    <div style="font-size: 48px; margin-bottom: 10px;">
                                        ${
                                          data.status === "ìˆ˜ì§‘ì™„ë£Œ"
                                            ? "âœ…"
                                            : data.collectDays >= 1
                                            ? "ğŸ¯"
                                            : "ğŸ˜´"
                                        }
                                    </div>
                                    <div style="font-size: 16px; color: #666;">
                                        ${
                                          data.status === "ìˆ˜ì§‘ì™„ë£Œ"
                                            ? "ì¸¡ì • ì™„ë£Œ!"
                                            : data.collectDays >= 1
                                            ? "ê¸°ìƒì¼ì´ ë˜ì—ˆìŠµë‹ˆë‹¤! ë°ì´í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”"
                                            : "ê¸°ìƒ ì˜ˆì •ì¼: " +
                                              data.collectStartDate +
                                              " (ì „ë‚  ë°¤ë¶€í„° ì¸¡ì •)"
                                        }
                                    </div>
                                </div>
                            </div>
                            <a href="#" class="guide-link" onclick="openGuide('check'); return false;">ğŸ” ë°ì´í„° í™•ì¸ ë°©ë²• ë³´ê¸° â†’</a>
                        `
                            : ""
                        }

                        ${
                          data.collectDays >= 1
                            ? `
                            <div class="action-button">
                                <button class="btn" onclick="updateStatus('ìˆ˜ì§‘ì™„ë£Œ')">âœ“ ì¸¡ì • ì™„ë£Œ ì•Œë¦¬ê¸°</button>
                            </div>
                        `
                            : ""
                        }
                    `
                : "",
          },
          {
            state:
              currentStep > 5 ? "completed" : currentStep === 5 ? "active" : "",
            title: "5ë‹¨ê³„: ë°ì´í„° í™•ì¸",
            description:
              "ì•±ì—ì„œ ìˆ˜ë©´ ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ê¸°ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.",
            content:
              currentStep === 5
                ? `
                        <a href="#" class="guide-link" onclick="openGuide('check'); return false;">ğŸ” ë°ì´í„° í™•ì¸ ë°©ë²• ë³´ê¸° â†’</a>
                        <div class="alert alert-info" style="margin-top: 16px; margin-bottom: 20px;">
                            ğŸ“Š ì•±ì—ì„œ ì§€ë‚œ ë°¤ ìˆ˜ë©´ ë°ì´í„°(ìˆ˜ë©´ ì‹œê°„, ë‹¨ê³„ ë“±)ë¥¼ í™•ì¸í•˜ì‹  í›„ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <p style="font-weight: bold; margin-bottom: 12px; color: #333;">
                                âœ… ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ê¸°ë¡ë˜ì—ˆë‚˜ìš”?
                            </p>
                        </div>

                        <div class="action-button" style="margin-bottom: 12px;">
                            <button class="btn" onclick="handleDataCheck(true)" style="background: #000000;">
                                âœ“ ë„¤, ë°ì´í„°ê°€ ì •ìƒì…ë‹ˆë‹¤
                            </button>
                        </div>
                        <div class="action-button">
                            <button class="btn" onclick="handleDataCheck(false)" style="background: #666666;">
                                âœ— ì•„ë‹ˆìš”, ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤
                            </button>
                        </div>
                    `
                : "",
          },
          {
            state:
              currentStep > 6 ? "completed" : currentStep === 6 ? "active" : "",
            title: "6ë‹¨ê³„: ì„¤ë¬¸ ì‘ì„±",
            description: "ìˆ˜ë©´ ë°ì´í„° ìˆ˜ì§‘ í›„ ì„¤ë¬¸ì¡°ì‚¬ì— ì°¸ì—¬í•´ì£¼ì„¸ìš”.",
            content:
              currentStep === 6
                ? `
                        <div class="alert alert-success" style="margin-bottom: 20px;">
                            ğŸ‰ ë°ì´í„° í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì„¤ë¬¸ ì‘ì„±ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; border: 2px solid #000000; margin-bottom: 20px;">
                            <p style="font-weight: bold; margin-bottom: 12px; color: #333;">
                                ğŸ“ ì„¤ë¬¸ ì‘ì„± (ì•½ 5-10ë¶„ ì†Œìš”)
                            </p>
                            <p style="font-size: 14px; color: #666; margin-bottom: 16px;">
                                ì•„ë˜ ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ Google Formì—ì„œ ì„¤ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.
                            </p>
                            <a href="https://docs.google.com/forms/d/1bYBF37q9ZE6Kkn3_NPYD-yDbLJvZK4jsWdYZC40w3wA/viewform" 
                               target="_blank"
                               style="display: inline-block; background: #ffeb3b; color: #000000; padding: 12px 24px; text-decoration: none; border-radius: 8px; border: 2px solid #000000; font-weight: bold; margin-bottom: 16px;">
                                ğŸ“‹ ì„¤ë¬¸ ì‘ì„±í•˜ëŸ¬ ê°€ê¸° â†’
                            </a>
                        </div>
                        
                        <div class="checklist">
                            <div class="checklist-item">
                                <input type="checkbox" id="check-survey-done">
                                <label for="check-survey-done">ì„¤ë¬¸ ì‘ì„±ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</label>
                            </div>
                        </div>
                        
                        <div class="action-button">
                            <button class="btn" onclick="updateStatus('ì„¤ë¬¸ì™„ë£Œ')">âœ“ ì„¤ë¬¸ ì œì¶œ ì™„ë£Œ</button>
                        </div>
                    `
                : "",
          },
          {
            state:
              currentStep > 7 ? "completed" : currentStep === 7 ? "active" : "",
            title: "7ë‹¨ê³„: ë°ì´í„° ì œì¶œ",
            description: "ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ì—°êµ¬íŒ€ì— ì œì¶œí•©ë‹ˆë‹¤.",
            content:
              currentStep === 7
                ? `
                        <div class="alert alert-success" style="margin-bottom: 20px;">
                            ğŸ‰ ì„¤ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ë°ì´í„°ë¥¼ ì œì¶œí•´ì£¼ì„¸ìš”.
                        </div>
                        
                        <div class="checklist">
                            <div class="checklist-item">
                                <input type="checkbox" id="check-data-consent">
                                <label for="check-data-consent">ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ì—°êµ¬ ëª©ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” ê²ƒì— ë™ì˜í•©ë‹ˆë‹¤</label>
                            </div>
                        </div>
                        
                        <div class="action-button">
                            <button class="btn" onclick="updateStatus('ë°ì´í„°ì œì¶œì™„ë£Œ')">âœ“ ë°ì´í„° ì œì¶œí•˜ê¸°</button>
                        </div>
                    `
                : "",
          },
          {
            state:
              currentStep > 8 ? "completed" : currentStep === 8 ? "active" : "",
            title: "8ë‹¨ê³„: ë§¤ë‹ˆì € ë°ì´í„° í™•ì¸",
            description:
              "ë§¤ë‹ˆì €ê°€ ì œì¶œëœ ë°ì´í„°ë¥¼ ê²€í†  ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.",
            content:
              currentStep === 8
                ? `
                        <div class="alert alert-info">
                            â³ ë§¤ë‹ˆì €ê°€ ë°ì´í„°ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...<br>
                            ì™„ë£Œë˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.
                        </div>
                    `
                : "",
          },
          {
            state:
              currentStep > 9 ? "completed" : currentStep === 9 ? "active" : "",
            title: "9ë‹¨ê³„: ê¸°ê¸° ë°˜ë‚© ì¤€ë¹„",
            description: `ë°ì´í„° ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!${
              data.pickupDate && data.pickupDate !== "ì¡°ìœ¨ ì¤‘"
                ? "<br><strong>íšŒìˆ˜ ì˜ˆì •ì¼: " + data.pickupDate + "</strong>"
                : "<br>ê³§ íƒë°° íšŒìˆ˜ ì¼ì •ì„ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤."
            }`,
            content:
              currentStep === 9
                ? `
                        <div class="checklist">
                            <div class="checklist-item">
                                <input type="checkbox" id="check-packed">
                                <label for="check-packed">ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ì™€ ì¶©ì „ê¸°ë¥¼ ë°•ìŠ¤ì— ë‹´ì•˜ìŠµë‹ˆë‹¤</label>
                            </div>
                            <div class="checklist-item">
                                <input type="checkbox" id="check-ready">
                                <label for="check-ready">íƒë°° ê¸°ì‚¬ë‹˜ ë°©ë¬¸ ì¤€ë¹„ ì™„ë£Œ</label>
                            </div>
                        </div>
                        <div class="action-button">
                            <button class="btn" onclick="updateStatus('íšŒìˆ˜ëŒ€ê¸°')">âœ“ ë°˜ë‚© ì¤€ë¹„ ì™„ë£Œ ì•Œë¦¬ê¸°</button>
                        </div>
                    `
                : "",
          },
          {
            state: currentStep >= 10 ? "completed" : "",
            title: "10ë‹¨ê³„: ì™„ë£Œ! ğŸ‰",
            description:
              "ë°ì´í„° ìˆ˜ì§‘ í”„ë¡œì íŠ¸ì— ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!<br>ê·€í•˜ì˜ ë°ì´í„°ëŠ” ìˆ˜ë©´ ì—°êµ¬ì— í° ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.",
            content:
              currentStep >= 10
                ? `
                        <div class="alert alert-success">
                            âœ… ëª¨ë“  ë‹¨ê³„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì†Œì •ì˜ ì°¸ê°€ë¹„ëŠ” 2-3ì¼ ë‚´ë¡œ ì§€ê¸‰ë©ë‹ˆë‹¤.
                        </div>
                    `
                : "",
          },
        ];
      }

      // ===== ìƒíƒœë³„ ë‹¨ê³„ ë²ˆí˜¸ =====
      function getStepNumber(status) {
        const steps = {
          ëŒ€ê¸°ì¤‘: 1,
          ìŠ¬ë™ì°¸ì—¬: 1,
          ë°œì†¡ì™„ë£Œ: 2,
          ìˆ˜ë ¹í™•ì¸í•„ìš”: 2,
          ìˆ˜ë ¹ì™„ë£Œ: 3,
          ì—°ë™ëŒ€ê¸°: 3,
          ì—°ë™ì™„ë£Œ: 3,
          ìˆ˜ì§‘ì¤‘: 4,
          ìˆ˜ì§‘ì™„ë£Œ: 5,
          ë°ì´í„°í™•ì¸ì™„ë£Œ: 6,
          ì„¤ë¬¸ì™„ë£Œ: 7,
          ë°ì´í„°ì œì¶œì™„ë£Œ: 8,
          ë§¤ë‹ˆì €í™•ì¸ì™„ë£Œ: 9,
          íšŒìˆ˜ëŒ€ê¸°: 9,
          íšŒìˆ˜ì™„ë£Œ: 10,
        };
        return steps[status] || 1;
      }

      // ===== ë°ì´í„° í™•ì¸ ì²˜ë¦¬ =====
      async function handleDataCheck(isOk) {
        if (!currentUser) return;

        if (isOk) {
          // ë°ì´í„°ê°€ ì •ìƒì¸ ê²½ìš° -> ë°ì´í„°í™•ì¸ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½
          await updateStatus("ë°ì´í„°í™•ì¸ì™„ë£Œ");
        } else {
          // ë¬¸ì œê°€ ìˆëŠ” ê²½ìš° -> ìŠ¬ë™ìœ¼ë¡œ ë¬¸ì˜ ì•ˆë‚´
          alert(
            "â—ï¸ ìŠ¬ë™ì—ì„œ ë§¤ë‹ˆì €ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.\n\në¬¸ì œ ìƒí™©ì„ ìì„¸íˆ ì•Œë ¤ì£¼ì‹œë©´ ë¹ ë¥´ê²Œ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
          );
        }
      }

      // ===== ìƒíƒœ ì—…ë°ì´íŠ¸ =====
      async function updateStatus(newStatus) {
        if (!currentUser) return;

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ í™•ì¸
        if (!validateChecklist(newStatus)) {
          alert("âœ‹ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ì™„ë£Œí•´ì£¼ì„¸ìš”.");
          return;
        }

        // ë°ì´í„°í™•ì¸ì™„ë£ŒëŠ” confirm ì—†ì´ ë°”ë¡œ ì§„í–‰
        const skipConfirm = newStatus === "ë°ì´í„°í™•ì¸ì™„ë£Œ";
        if (
          !skipConfirm &&
          !confirm(`ìƒíƒœë¥¼ '${newStatus}'ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)
        ) {
          return;
        }

        // ë²„íŠ¼ ë¹„í™œì„±í™”
        const buttons = document.querySelectorAll(".btn");
        buttons.forEach((btn) => (btn.disabled = true));

        try {
          const response = await fetch(SCRIPT_URL, {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: JSON.stringify({
              action: "updateStatus",
              id: currentUser.id,
              status: newStatus,
            }),
          });

          const result = await response.json();

          if (result.success) {
            alert("âœ… ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!");
            // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            await refreshData();
          } else {
            alert("âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: " + result.message);
          }
        } catch (error) {
          alert("âŒ ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          console.error(error);
        } finally {
          buttons.forEach((btn) => (btn.disabled = false));
        }
      }

      // ===== ë°ì´í„° ìƒˆë¡œê³ ì¹¨ =====
      async function refreshData() {
        try {
          const response = await fetch(SCRIPT_URL, {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: JSON.stringify({
              action: "getParticipant",
              id: currentUser.id,
              name: currentUser.name,
            }),
          });

          const result = await response.json();
          if (result.success) {
            currentUser = result.data;
            showProgress(result.data);
          }
        } catch (error) {
          console.error(error);
        }
      }

      // ===== ì¸¡ì •ì¼ ì—…ë°ì´íŠ¸ =====
      async function updateMeasureDate() {
        if (!currentUser) return;

        const dateInput = document.getElementById("measure-date");
        const selectedDate = dateInput.value;

        if (!selectedDate) {
          alert("ğŸ“… ì¸¡ì • ì˜ˆì •ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
          return;
        }

        if (!confirm(`ì¸¡ì • ì˜ˆì •ì¼ì„ ${selectedDate}ë¡œ ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
          return;
        }

        try {
          const response = await fetch(SCRIPT_URL, {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: JSON.stringify({
              action: "updateMeasureDate",
              id: currentUser.id,
              date: selectedDate,
            }),
          });

          const result = await response.json();

          if (result.success) {
            alert("âœ… ì¸¡ì • ì˜ˆì •ì¼ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
            await refreshData();
          } else {
            alert("âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: " + result.message);
          }
        } catch (error) {
          alert("âŒ ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          console.error(error);
        }
      }

      // ===== ì²´í¬ë¦¬ìŠ¤íŠ¸ ê²€ì¦ =====
      function validateChecklist(status) {
        if (status === "ìˆ˜ë ¹ì™„ë£Œ") {
          const check1 = document.getElementById("check-received");
          const check2 = document.getElementById("check-contents");
          return check1 && check2 && check1.checked && check2.checked;
        }
        if (status === "ì—°ë™ì™„ë£Œ") {
          const check1 = document.getElementById("check-app-install");
          const check2 = document.getElementById("check-device-sync");
          const check3 = document.getElementById("check-data-visible");
          return (
            check1 &&
            check2 &&
            check3 &&
            check1.checked &&
            check2.checked &&
            check3.checked
          );
        }
        if (status === "ìˆ˜ì§‘ì¤‘") {
          // ìˆ˜ì§‘ì¤‘ì€ ë‚ ì§œ ì„ íƒ í›„ ìë™ìœ¼ë¡œ ì „í™˜ë˜ë¯€ë¡œ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¶ˆí•„ìš”
          return true;
        }
        if (status === "ë°ì´í„°í™•ì¸ì™„ë£Œ") {
          return true; // ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ì²˜ë¦¬
        }
        if (status === "ì„¤ë¬¸ì™„ë£Œ") {
          const check1 = document.getElementById("check-survey-done");
          return check1 && check1.checked;
        }
        if (status === "ë°ì´í„°ì œì¶œì™„ë£Œ") {
          const check1 = document.getElementById("check-data-consent");
          return check1 && check1.checked;
        }
        if (status === "íšŒìˆ˜ëŒ€ê¸°") {
          const check1 = document.getElementById("check-packed");
          const check2 = document.getElementById("check-ready");
          return check1 && check2 && check1.checked && check2.checked;
        }
        return true;
      }

      // ===== ê°€ì´ë“œ ì—´ê¸° =====
      function openGuide(type) {
        // ì‹¤ì œ ê°€ì´ë“œ ë¬¸ì„œ ë§í¬ë¡œ ë³€ê²½
        const guides = {
          app: "https://docs.google.com/presentation/d/1UvG6Vl1lWJlcOITc3KmaJboFYnmo1FDiJ-nk9qrsrH8/edit?slide=id.g37e30063af9_0_89#slide=id.g37e30063af9_0_89",
          check:
            "https://docs.google.com/presentation/d/1UvG6Vl1lWJlcOITc3KmaJboFYnmo1FDiJ-nk9qrsrH8/edit?slide=id.g37e30063af9_0_231#slide=id.g37e30063af9_0_231",
        };
        if (guides[type]) {
          window.open(guides[type], "_blank");
        }
      }

      // ===== ìƒíƒœë³„ ìƒ‰ìƒ =====
      function getStatusColor(status) {
        const colors = {
          ëŒ€ê¸°ì¤‘: "#6c757d",
          ìŠ¬ë™ì°¸ì—¬: "#2196f3",
          ë°œì†¡ì™„ë£Œ: "#ffa500",
          ìˆ˜ë ¹ì™„ë£Œ: "#2196f3",
          ì—°ë™ëŒ€ê¸°: "#ff6b6b",
          ì—°ë™ì™„ë£Œ: "#2196f3",
          ìˆ˜ì§‘ì¤‘: "#4caf50",
          ìˆ˜ì§‘ì™„ë£Œ: "#4caf50",
          íšŒìˆ˜ëŒ€ê¸°: "#667eea",
          íšŒìˆ˜ì™„ë£Œ: "#333",
        };
        return colors[status] || "#6c757d";
      }

      // ===== ì—ëŸ¬ í‘œì‹œ =====
      function showError(elementId, message) {
        const errorDiv = document.getElementById(elementId);
        errorDiv.textContent = "âŒ " + message;
        errorDiv.style.display = "block";
      }

      // ===== ë¡œê·¸ì•„ì›ƒ =====
      function logout() {
        currentUser = null;
        document.getElementById("login-card").style.display = "block";
        document.getElementById("progress-card").style.display = "none";
        document.getElementById("participant-id").value = "";
        document.getElementById("participant-name").value = "";
      }

      // ===== URL íŒŒë¼ë¯¸í„° ìë™ ë¡œê·¸ì¸ =====
      window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get("id");
        const name = urlParams.get("name");

        if (id && name) {
          document.getElementById("participant-id").value = id;
          document.getElementById("participant-name").value = name;
          // ìë™ ë¡œê·¸ì¸ ì›í•˜ë©´ login() í˜¸ì¶œ
        }
      };
    </script>
  </body>
</html>
